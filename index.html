<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Hangama</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




    <!-- Ads Fix for Mobile - V2 -->
    <style>
        /* यह विज्ञापन के मुख्य कंटेनर को कंट्रोल करता है */
        .ad-space {
            /* हम चौड़ाई को ऑटो पर सेट करेंगे ताकि यह अपने अंदर के कंटेंट के हिसाब से फिट हो */
            width: fit-content; 
            max-width: 100%; /* यह सुनिश्चित करता है कि यह स्क्रीन से बाहर न जाए */
            margin-left: auto;
            margin-right: auto;
            overflow: hidden; /* अगर कुछ बाहर जाए तो उसे छिपा दें */
            
            /* बॉर्डर और पैडिंग हटा दें जब विज्ञापन लोड हो जाए */
            border: none;
            padding: 0;
            background-color: transparent; /* बैकग्राउंड को पारदर्शी बना दें */
            
            /* लेआउट को स्थिर रखने के लिए न्यूनतम ऊंचाई */
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* नीचे वाले विज्ञापन के लिए अलग न्यूनतम ऊंचाई */
        #ad-space-bottom {
            min-height: 250px;
        }

        /* यह सीधे विज्ञापन के iframe को टारगेट करता है */
        .ad-space iframe {
            max-width: 100%;
            display: block; /* iframe के नीचे की अतिरिक्त जगह हटाता है */
        }
    </style>

</head> <!-- यह टैग पहले से होगा, इसके ठीक ऊपर पेस्ट करें -->




</head>
<body>

    <!-- ==================== Header ==================== -->
    <header>
        <div class="container header-container">
            <a href="#" class="logo">Anime Hangama</a>
            <nav>
                <div class="search-wrapper">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search titles...">
                    <button class="search-icon-btn" id="searchIconBtn"><i class="material-icons">search</i></button>
                </div>
                <button class="theme-toggle-btn" id="themeToggle" title="Toggle Theme"><i class="material-icons">brightness_6</i></button>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <!-- ==================== Ad Space (Top) ==================== -->
        <div class="ad-space" id="ad-space-top">
            <p>............720x90 ads.........</p>
        </div>

        <!-- ==================== Anime Grid Section ==================== -->
        <h2 class="section-title">Latest Posts</h2>
        <div id="anime-grid">
            <!-- Loading Spinner will be shown here initially -->
            <div class="grid-loader"></div>
        </div>
        
      
      
      
      
      
        <!-- ==================== Ad Space (Bottom) ==================== -->
        <div class="ad-space" id="ad-space-bottom">
            <p> space for ads</p>
        </div>

    </main>

    <!-- ==================== Footer ==================== -->


	<!-- ==================== Footer ==================== -->
<footer style="text-align: center; padding: 1.5rem 0; margin-top: 2rem; background-color: var(--bg-secondary); border-top: 1px solid var(--border-color); color: var(--text-secondary);">
    <p>© 2025 Anime Hangama. All Rights Reserved.</p>
    <div class="footer-links" style="margin-top: 0.75rem;">
        <!-- यह आपका नया डिस्क्लेमर लिंक है -->
        <a href="disclaimer.html" style="color: var(--text-secondary); text-decoration: none; margin: 0 10px;">Disclaimer</a>
    </div>
</footer>
  
  
  

    <!-- JavaScript File -->
    


<script>
    // फाइनल और सही कोड - यह 100% काम करेगा

    document.addEventListener('DOMContentLoaded', () => {

        const animeGrid = document.getElementById('anime-grid');
        // यह सुनिश्चित करें कि यह आपका सही और पूरा सर्वर URL है
        const backendBaseUrl = 'https://anime-hangama.onrender.com';

        // यह फंक्शन सर्वर को सही और पूरा URL भेजता है
        const updateCounter = (postId, type) => {
            if (!postId || !type) return;
            // यहाँ हम पूरा URL बना रहे हैं
            const url = `${backendBaseUrl}/api/posts/${type}/${postId}`;
            
            if (navigator.sendBeacon) {
                navigator.sendBeacon(url);
            } else {
                fetch(url, { method: 'PATCH', keepalive: true }).catch(err => {});
            }
        };

        // यह फंक्शन सर्वर से पोस्ट्स लाता है
        const loadPosts = async () => {
            animeGrid.innerHTML = '<div><div class="grid-loader"></div><p style="text-align:center; color: var(--text-secondary);">Connecting to server, please wait...</p></div>';

            try {
                const response = await fetch(`${backendBaseUrl}/api/posts`);
                if (!response.ok) throw new Error(`Network response was not ok`);
                
                const posts = await response.json();
                renderPosts(posts);

            } catch (error) {
                animeGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center;">Error: Could not load posts. Please try again later. ${error.message}</p>`;
            }
        };

        // यह फंक्शन पोस्ट्स को स्क्रीन पर दिखाता है
        const renderPosts = (postsToRender) => {
            animeGrid.innerHTML = '';
            if (!postsToRender || postsToRender.length === 0) {
                animeGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">No posts available right now.</p>';
                return;
            }

            postsToRender.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            postsToRender.forEach(post => {
                const card = document.createElement('div');
                card.className = 'anime-card';

                card.innerHTML = `
                    <div class="card-img-wrapper">
                        <img src="${post.imageUrl}" alt="${post.title}" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title" title="${post.title}">${post.title}</h3>
                        <div class="card-footer">
                            <span class="view-count">
                                <i class="material-icons" style="font-size: 1rem;">visibility</i>
                                <span id="views-${post._id}">${(post.views || 0).toLocaleString()}</span>
                            </span>
                            <a href="${post.link}" target="_blank" class="card-link" rel="noopener noreferrer">Watch Now</a>
                        </div>
                    </div>
                `;

                const cardLink = card.querySelector('.card-link');

                cardLink.addEventListener('click', (e) => {
                    e.stopPropagation();
                    updateCounter(post._id, 'click');
                });

                card.addEventListener('click', (e) => {
                    if (e.target.closest('.card-link')) return;

                    const viewElement = document.getElementById(`views-${post._id}`);
                    if (viewElement) {
                        const currentViews = parseInt(viewElement.textContent.replace(/,/g, '')) || 0;
                        viewElement.textContent = (currentViews + 1).toLocaleString();
                    }
                    
                    updateCounter(post._id, 'view');
                    window.open(post.link, '_blank');
                });

                animeGrid.appendChild(card);
            });
        };

        loadPosts();
    });
				  </script>

	
	
	
  
</body>
</html>
