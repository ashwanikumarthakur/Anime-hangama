<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime Hangama</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts & Icons -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">




    <!-- Ads Fix for Mobile - V2 -->
    <style>
        /* यह विज्ञापन के मुख्य कंटेनर को कंट्रोल करता है */
        .ad-space {
            /* हम चौड़ाई को ऑटो पर सेट करेंगे ताकि यह अपने अंदर के कंटेंट के हिसाब से फिट हो */
            width: fit-content; 
            max-width: 100%; /* यह सुनिश्चित करता है कि यह स्क्रीन से बाहर न जाए */
            margin-left: auto;
            margin-right: auto;
            overflow: hidden; /* अगर कुछ बाहर जाए तो उसे छिपा दें */
            
            /* बॉर्डर और पैडिंग हटा दें जब विज्ञापन लोड हो जाए */
            border: none;
            padding: 0;
            background-color: transparent; /* बैकग्राउंड को पारदर्शी बना दें */
            
            /* लेआउट को स्थिर रखने के लिए न्यूनतम ऊंचाई */
            min-height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* नीचे वाले विज्ञापन के लिए अलग न्यूनतम ऊंचाई */
        #ad-space-bottom {
            min-height: 250px;
        }

        /* यह सीधे विज्ञापन के iframe को टारगेट करता है */
        .ad-space iframe {
            max-width: 100%;
            display: block; /* iframe के नीचे की अतिरिक्त जगह हटाता है */
        }
    </style>

</head> <!-- यह टैग पहले से होगा, इसके ठीक ऊपर पेस्ट करें -->




</head>
<body>

    <!-- ==================== Header ==================== -->
    <header>
        <div class="container header-container">
            <a href="#" class="logo">Anime Hangama</a>
            <nav>
                <div class="search-wrapper">
                    <input type="text" id="searchInput" class="search-input" placeholder="Search titles...">
                    <button class="search-icon-btn" id="searchIconBtn"><i class="material-icons">search</i></button>
                </div>
                <button class="theme-toggle-btn" id="themeToggle" title="Toggle Theme"><i class="material-icons">brightness_6</i></button>
            </nav>
        </div>
    </header>

    <main class="container">
        
        <!-- ==================== Ad Space (Top) ==================== -->
        <div class="ad-space" id="ad-space-top">
            <p>............720x90 ads.........</p>
        </div>

        <!-- ==================== Anime Grid Section ==================== -->
        <h2 class="section-title">Latest Posts</h2>
        <div id="anime-grid">
            <!-- Loading Spinner will be shown here initially -->
            <div class="grid-loader"></div>
        </div>
        
      
      
      
      
      
        <!-- ==================== Ad Space (Bottom) ==================== -->
        <div class="ad-space" id="ad-space-bottom">
            <p> space for ads</p>
        </div>

    </main>

    <!-- ==================== Footer ==================== -->


	<!-- ==================== Footer ==================== -->
<footer style="text-align: center; padding: 1.5rem 0; margin-top: 2rem; background-color: var(--bg-secondary); border-top: 1px solid var(--border-color); color: var(--text-secondary);">
    <p>© 2025 Anime Hangama. All Rights Reserved.</p>
    <div class="footer-links" style="margin-top: 0.75rem;">
        <!-- यह आपका नया डिस्क्लेमर लिंक है -->
        <a href="disclaimer.html" style="color: var(--text-secondary); text-decoration: none; margin: 0 10px;">Disclaimer</a>
    </div>
</footer>
  
  
  

    <!-- JavaScript File -->
    



                
<script>
    // --- अंतिम, पूरा और सुधरा हुआ फ्रंटएंड कोड ---

    document.addEventListener('DOMContentLoaded', () => {

        // --- जरूरी एलिमेंट्स को चुनें ---
        const animeGrid = document.getElementById('anime-grid');
        const searchInput = document.getElementById('searchInput');
        const searchIconBtn = document.getElementById('searchIconBtn');
        const themeToggle = document.getElementById('themeToggle');

        // --- कॉन्फ़िगरेशन ---
        const backendBaseUrl = 'https://anime-hangama.onrender.com';
        let allPosts = []; // सारे पोस्ट्स को एक जगह सेव करें ताकि सर्च में काम आए

        // ===============================================================
        //    1. सर्वर को व्यूज/क्लिक्स का सिग्नल भेजने वाला फंक्शन
        // ===============================================================
        const updateCounter = (postId, type) => {
            if (!postId || !type) return;
            const url = `${backendBaseUrl}/api/posts/${type}/${postId}`;
            
            // fetch का उपयोग करें ताकि हम Network टैब में रिक्वेस्ट देख सकें
            fetch(url, {
                method: 'PATCH',
                mode: 'cors',    // CORS पॉलिसी को स्पष्ट रूप से बताएं
                keepalive: true  // यह सुनिश्चित करता है कि पेज बंद होने पर भी रिक्वेस्ट जाए
            })
            .catch(error => {
                console.error(`Network error for ${type} count:`, error);
            });
        };

        // ===============================================================
        //    2. सर्वर से सारे पोस्ट्स लाने वाला फंक्शन
        // ===============================================================
        const loadPosts = async () => {
            if (!animeGrid) return;
            animeGrid.innerHTML = '<div><div class="grid-loader"></div><p style="text-align:center; color: var(--text-secondary);">Connecting to server...</p></div>';
            
            try {
                const response = await fetch(`${backendBaseUrl}/api/posts`);
                if (!response.ok) throw new Error(`Network Error: ${response.status}`);
                
                const posts = await response.json();
                allPosts = posts; // सारे पोस्ट्स को भविष्य के लिए सेव कर लें
                renderPosts(allPosts); // और स्क्रीन पर दिखा दें

            } catch (error) {
                animeGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center;">Error loading posts. Please try again later.</p>`;
                console.error("Error details:", error);
            }
        };

        // ===============================================================
        //    3. पोस्ट्स को HTML में बदलकर स्क्रीन पर दिखाने वाला फंक्शन
        // ===============================================================
        const renderPosts = (postsToRender) => {
            if (!animeGrid) return;
            animeGrid.innerHTML = '';

            if (!postsToRender || postsToRender.length === 0) {
                animeGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center;">No matching posts found.</p>';
                return;
            }

            postsToRender.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            postsToRender.forEach(post => {
                const card = document.createElement('div');
                card.className = 'anime-card';

                card.innerHTML = `
                    <div class="card-img-wrapper">
                        <img src="${post.imageUrl}" alt="${post.title}" loading="lazy">
                    </div>
                    <div class="card-content">
                        <h3 class="card-title" title="${post.title}">${post.title}</h3>
                        <div class="card-footer">
                            <span class="view-count">
                                <i class="material-icons" style="font-size: 1rem;">visibility</i>
                                <span id="views-${post._id}">${(post.views || 0).toLocaleString()}</span>
                            </span>
                            <a href="${post.link}" target="_blank" class="card-link" rel="noopener noreferrer">Watch Now</a>
                        </div>
                    </div>
                `;

                // --- क्लिक्स को हैंडल करना ---
                const cardLink = card.querySelector('.card-link');
                
                // "Watch Now" बटन पर क्लिक
                cardLink.addEventListener('click', (e) => {
                    e.stopPropagation(); // कार्ड के क्लिक को रोकें
                    updateCounter(post._id, 'click');
                });
                
                // पूरे कार्ड पर क्लिक (बटन को छोड़कर)
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.card-link')) return;
                    
                    // व्यूज को तुरंत स्क्रीन पर बढ़ाएं
                    const viewElement = document.getElementById(`views-${post._id}`);
                    if (viewElement) {
                        const currentViews = parseInt(viewElement.textContent.replace(/,/g, '')) || 0;
                        viewElement.textContent = (currentViews + 1).toLocaleString();
                    }
                    
                    updateCounter(post._id, 'view');
                    window.open(post.link, '_blank');
                });

                animeGrid.appendChild(card);
            });
        };

        // ===============================================================
        //    4. सर्च और थीम को हैंडल करने वाले फंक्शन्स
        // ===============================================================
        
        // सर्च फंक्शन
        const handleSearch = () => {
            const searchTerm = searchInput.value.toLowerCase();
            const filteredPosts = allPosts.filter(post => 
                post.title.toLowerCase().includes(searchTerm)
            );
            renderPosts(filteredPosts);
        };

        // थीम टॉगल फंक्शन
        const handleThemeToggle = () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        };

        // पहले से सेव की हुई थीम को लोड करें
        const loadSavedTheme = () => {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.setAttribute('data-theme', savedTheme);
            }
        };

        // --- इवेंट्स को लगाना ---
        searchIconBtn.addEventListener('click', () => searchInput.classList.toggle('active') && searchInput.focus());
        searchInput.addEventListener('input', handleSearch);
        themeToggle.addEventListener('click', handleThemeToggle);

        // ===============================================================
        //    5. वेबसाइट को शुरू करना
        // ===============================================================
        loadSavedTheme(); // सबसे पहले थीम लोड करें
        loadPosts();      // फिर सर्वर से पोस्ट्स लोड करें

    });
</script>


	
  
</body>
</html>
